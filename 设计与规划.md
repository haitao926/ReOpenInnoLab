整体愿景

  - 构建面向中小学的“未来校园控制台”，以 AI 驱动课程编排、课堂实施、实验探究、作业批改与学习反馈的全流程闭环。
  - 品牌体验强调“温暖科技”，借鉴苹果玻璃质感与克制动效，同时融合教育元素（校徽、学科色、粉笔粒子等）。
  - 核心指标聚焦课程生产效率、课堂参与度、实验完成率、作业批改时长与学生掌握度可视化。
  - 平台需支持多校区、多角色协同，兼顾 SaaS 扩张与私有化部署。

  角色与用户旅程

  - 学校管理员：配置学校信息、教职工账号、角色权限、课程资源审核以及教学数据总览。
  - 教师：创建课程、编排章节、配置实验/体验/作业、主持课堂、批改作业、查看学生画像与教学效果。
  - 学生：进入班级、参与课程与实验、提交作业、查看反馈、跟进个性化学习建议。
  - 家长/校领导：查看学生/班级的学习进度、成绩表现与课堂参与情况，可订阅关键节点报告。
  - 教研/运营团队：管理课程模板、教学法标签、AI 提示词库、跨校资源市场，维护教学质量。

  业务域设计

  - 课程域：课程库、版本管理、章节结构、AI 草拟、内容协作、课程市场共享与导入导出。
  - 班级域：班级生命周期、学生导入与分组、排课、实时课堂控制、互动与签到记录。
  - 实验域：Jupyter/AI/文件型实验模板、环境调度、资源配额、实验成绩与反馈。
  - 交互体验域：HTML/多媒体体验上传、自动安全检测、预览沙箱、埋点配置、体验版本。
  - 作业域：题库、AI 出题、批改流程、成绩册、知识点掌握度、学习干预建议。
  - 洞察域：课堂热力、课程效果雷达、学生画像、模型使用监控、风险告警面板。

  内容模型 (.acl)

  - 统一 JSON 格式 AiCourseLayout(.acl)，由 meta、courseInfo、structure、resourceRefs 组成，支持语义化版本。
  - 章节树支持 introduction、knowledge、activity、assignment 等类型，并包含 aiHints、assessment、expectedOutcome 等扩展字段。
  - 实验与作业资源共用 .acl 结构，描述 resourceInfo（环境、依赖、完成条件）、steps、gradingMatrix、aiPrompts。
  - SDK（TypeScript/Python）提供解析、校验、diff、版本回滚、渲染辅助；GraphQL SDL + JSON Schema 双定义，便于前后端共享。
  - 资源引用采用 resource://domain/id 规范，支持跨域一致性校验与快速检索。

  前端架构 (Vue + Element Plus)

  - 使用 Vue 3 + TypeScript + Vite，按领域模块拆包，配合动态加载提升首屏与课堂性能。
  - 状态管理采用 Pinia，store 根据业务域划分，并封装缓存策略、时间旅行与多租户隔离；Vue Router 4 管理权限守卫与流程拦截。
  - 设计系统基于 Element Plus 深度定制主题（色板、阴影、动效曲线、玻璃材质），结合 Tailwind 原子化 token、Framer Motion for Vue/GSAP 实现苹果风动效。
  - 数据通信通过 Axios 单例处理 Token、CSRF、多租户头、错误提示与重试；课堂与实验实时数据封装 WebSocket/SSE composable。
  - 工程规范包括 ESLint+Prettier+Stylelint、Vitest+Vue Testing Library、Cypress、Husky/Lint-staged、Storybook 组件文档、Vue I18n 国际化与暗色主题。
  - 核心页面遵循三栏或多分屏布局：课程工作台、班级仪表盘、实验工作坊、作业批改台、体验中心等均提供沉浸式交互和可访问性支持。

  后端架构 (Node.js + NestJS)

  - NestJS + TypeScript 搭建领域化模块，初期单体部署，随后借助 Nest Microservices + Kafka 演进为分布式；接口同时支持 REST 和 GraphQL（Apollo Federation）。
  - 领域模块涵盖 course, classroom, lab, experience, assignment, identity, insight, ai，通过依赖倒置与领域事件保持解耦。
  - 数据访问采用 Prisma 或 TypeORM 对接 PostgreSQL/MySQL，使用 Redis 做缓存、课堂实时状态及队列缓冲。
  - 消息与工作流：Kafka/RabbitMQ 处理跨域事件，Temporal/Camunda 编排课程审批、实验执行、作业批改等长流程，Agenda/Quartz 做定时任务。
  - 实验运行由 lab-service 与 Kubernetes/JupyterHub 对接，使用 @kubernetes/client-node 管理容器、挂载 .acl 资源、分配 GPU/CPU。
  - 安全栈：Keycloak/Passport JWT SSO + RBAC，Casbin/Nest Access Control 实现 ABAC；API Gateway（Kong/Nginx）负责限流、熔断、审计；日志写入 Elasticsearch。

  AI 与实验服务

  - ai-service 基于 LangChain/Semantic Kernel 调度 LLM/多模态模型，管理 Prompt 模板、版本、评测、敏感过滤；支持热切换与 A/B 测试。
  - 课程阶段 AI：自动生成纲要、教学目标、素材建议；活动阶段匹配实验/体验模板；课堂阶段提供实时问答、问题聚类、节奏提示；作业阶段出题、批改、反馈；学习阶段生成个性化补救建议。
  - 实验服务支持 Notebook、AI 模型训练/推理、文件上传三类场景，提供自动评分脚本、AI 审阅、教师实时查看与介入。
  - HTML 体验沙箱通过专用渲染服务进行安全扫描（CSP、XSS 过滤）、多设备预览、埋点采集、版本回滚。
  - AI 操作审计与可解释性：记录提示词、模型、版本、输出摘要，供教师与管理员追溯。

  数据与基础设施

  - 数据存储：PostgreSQL（事务）、Redis（缓存/课堂状态）、ClickHouse（行为分析）、TimescaleDB（时序课堂）、MinIO/S3（课程与实验文件）、ElasticSearch（全文检索）、Neo4j/ArangoDB（知识图谱）。
  - 数据管道：Kafka + Debezium 捕获变更写入分析仓，ETL/ELT 构建学习画像与教学效果模型，PowerBI/Grafana 等呈现可视化。
  - 可观测性：OpenTelemetry 全链路追踪，Prometheus + Grafana 指标监控，Loki/ELK 日志聚合，Sentry 捕获前后端错误。
  - 配置与特性：Consul/ConfigMap 管理配置，Feature Flag 服务（Unleash/Rollout）控制灰度功能，数据脱敏与备份策略覆盖关键表。
  - 多环境与部署：Docker + Kubernetes，GitHub Actions/GitLab CI + Argo CD 实现 GitOps，支持混合部署（公有云/本地机房）。

  安全与合规

  - 身份与权限：Keycloak/LDAP、RBAC + ABAC、细粒度策略到课程/实验/作业层级，支持多因子认证与家长独立权限。
  - 数据保护：存储加密、传输 HTTPS、敏感字段脱敏、访问审计、数据保留策略符合 GDPR/本地法规。
  - 内容安全：HTML/作业提交的安全扫描、AI 输出敏感词审查、异常行为检测（批量作业、实验滥用），配合风控策略。
  - 隐私与合规：用户同意、家长授权、未成年人保护、日志追踪、合规报告导出、应急响应预案。

  DevOps 与工程体系

  - CI/CD：单仓或多仓管理，Git Flow/Trunk Based 开发；测试（单元/集成/契约）与安全扫描（SAST/DAST）纳入流水线。
  - 环境标准化：dev/stage/prod，自动化数据脱敏同步；蓝绿/金丝雀发布；资源告警与自动扩缩容策略。
  - 工程实践：Monorepo（Nx/Turborepo）管理前后端共用包、.acl SDK；Backstage Dev Portal 管理文档、API、模型、运行环境。
  - 测试策略：契约测试（OpenAPI + Schemathesis）、服务 E2E（Jest + supertest）、前端视觉回归（Chromatic）、负载测试（k6）、AI pipeline 离线评估。
  - 质量治理：Code Review 规范、技术债看板、跨团队架构评审例会、回归测试矩阵。

  实施路线图

  - 起始阶段（0-3 个月）：定义 .acl Schema 与设计系统，完成 NestJS 基础服务、鉴权、课程/班级/用户骨架与 Element Plus 主题；交付课程编排器 MVP。
  - 拓展阶段（4-6 个月）：上线实验运行、作业批改 AI、班级实时仪表盘、交互体验沙箱；完成 iPad 课堂 Beta 与 AI 草稿功能。
  - 深化阶段（7-12 个月）：构建学习画像与洞察平台、课程市场、Prompt/模型治理后台；上线家长/校领导视图与课堂助教。
  - 优化阶段（12 个月+）：开放生态插件与内容 API、完善 AIOps 与合规体系、支持国际化、多模态 AI、自动调优实验资源。

  下一步建议

  - 完成 Element Plus 主题设计规范与高保真原型，建立组件 Storybook，确保视觉与交互统一。
  - 输出数据库 ER 图与 .acl JSON Schema，开发 NestJS 课程/班级/用户基础服务并发布 Swagger/GraphQL Schema。
  - 制作课程编排器、实验工作坊、作业批改台的前端原型，联调后端接口验证流程闭环与实时通道，为后续迭代奠定基础。