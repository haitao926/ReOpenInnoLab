# 课程全景设计需求文档

## 1. 项目概述

### 1.1 背景与目标
ReOpenInnoLab 教育平台旨在构建一体化的数字化教学环境，通过标准化的课程设计流程、沉浸式的课堂教学体验和智能化的教学辅助功能，提升教学质量和效率。

### 1.2 核心价值
- **教学标准化**：统一五环节教学模型，提升课程设计质量
- **体验一体化**：教师在单一系统内完成从备课到授课的全流程
- **互动实时性**：学生状态实时同步，实现真正的教-学协同
- **资源整合化**：多媒体资源统一管理，支持多样化的教学形式

## 2. 功能需求规格

### 2.1 课程全景设计

#### 2.1.1 五环节标准化结构
课程采用固定五环节编排模式，每环节包含标准化元数据：

```typescript
interface CourseStructure {
  id: string
  title: string
  description: string
  sections: CourseSection[]
}

interface CourseSection {
  type: 'introduction' | 'knowledge' | 'experience' | 'experiment' | 'assignment'
  title: string
  objectives: string[]          // 教学目标
  duration: number             // 预计用时（分钟）
  mediaRefs: ResourceRef[]     // 媒体资源引用
  resourceRefs: ResourceRef[]  // 教学资源引用
  aiHints: AIHint[]           // AI辅助提示
  classroomActions: Action[]  // 课堂活动设计
}
```

**环节详细说明：**

1. **课程引入 (introduction)**
   - 激活学生先验知识
   - 设定明确学习目标
   - 建立学习动机和期待

2. **新知讲解 (knowledge)**
   - PPT/视频/多媒体形式授课
   - 核心概念和知识点讲解
   - 支持AI自动生成讲稿

3. **体验理解 (experience)**
   - 互动小游戏或HTML体验
   - 模拟演示巩固概念理解
   - 实时反馈和数据收集

4. **实验活动 (experiment)**
   - Jupyter Notebook实验
   - AI辅助编程体验
   - HTML交互式实验

5. **作业测试 (assignment)**
   - 即时课堂测验
   - 课后作业布置
   - 自动评分和反馈

#### 2.1.2 资源引用系统
采用标准化资源引用格式：`resource://domain/id`

```typescript
interface ResourceRef {
  type: 'ppt' | 'video' | 'html' | 'notebook' | 'assignment' | 'image' | 'audio'
  domain: 'course' | 'lab' | 'assignment' | 'media'
  id: string
  version?: string
  metadata?: Record<string, any>
}
```

#### 2.1.3 课程编辑器功能
- **模板化创建**：提供五环节结构模板
- **拖拽排序**：支持环节顺序调整
- **资源挂载**：直接引用现有资源库
- **版本控制**：草稿/发布版本管理
- **AI集成**：自动生成内容建议

### 2.2 课堂播放流程

#### 2.2.1 课程分配机制
```typescript
interface LessonSchedule {
  courseId: string
  courseVersion: string
  classId: string
  scheduledTime: Date
  instructorId: string
  status: 'scheduled' | 'running' | 'completed' | 'cancelled'
}
```

**分配流程：**
1. 教师在课程详情页选择"分配至班级"
2. 选择目标班级和授课时间
3. 确认课程版本和资源依赖
4. 生成课堂计划，更新班级控制台状态

#### 2.2.2 Presenter 播放模式

**界面布局：**
```
┌─────────────────────────────────────────────────────────────┐
│ 当前环节 | 教学目标 | 倒计时 | AI助手                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                     主播放区域                              │
│                (根据环节类型渲染)                            │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│ 环节导航 | 教学提示 | 学生状态 | 实时动态                    │
├─────────────────────────────────────────────────────────────┤
│   上一段   |   暂停   |   下一段   |   结束上课   |   批注    │
└─────────────────────────────────────────────────────────────┘
```

**控制功能：**
- 键盘快捷键控制（←→切换环节，空格暂停/继续）
- 遥控器支持（演讲模式）
- 批注和激光笔工具
- AI实时建议生成

#### 2.2.3 状态管理
```typescript
interface PresenterState {
  lessonId: string
  currentSection: number
  status: 'idle' | 'starting' | 'running' | 'paused' | 'ended'
  startTime?: Date
  sectionTimings: Record<number, { start: Date, end?: Date }>
  studentStates: StudentState[]
  annotations: Annotation[]
}
```

### 2.3 资源渲染系统

#### 2.3.1 多媒体支持

**PPT渲染：**
- 后端预处理：Office文件 → HTML slides
- 前端播放：基于Swiper/Reveal.js的SlidePlayer
- 支持批注层和激光笔效果

**视频播放：**
- 统一MediaPlayer组件
- 支持HLS/MP4格式
- 播放控制、字幕、倍速功能

**HTML体验：**
- iframe沙箱环境
- postMessage通讯机制
- 全屏模式和反馈收集

**Notebook预览：**
- nbconvert静态HTML生成
- 教师端只读渲染
- 学生端独立运行环境

#### 2.3.2 资源预加载策略
```typescript
interface ResourcePreloader {
  // 预加载课程所有资源
  preloadCourseResources(courseId: string): Promise<void>

  // 获取缓存资源
  getCachedResource(resourceId: string): Promise<any>

  // 离线模式支持
  enableOfflineMode(): void

  // 资源健康检查
  validateResources(resources: ResourceRef[]): Promise<boolean>
}
```

### 2.4 班级与学生联动

#### 2.4.1 实时同步机制
- **WebSocket通信**：教师端状态实时广播
- **学生端订阅**：班级频道自动接收同步指令
- **状态一致性**：确保所有学生看到相同内容

#### 2.4.2 学生状态回传
```typescript
interface StudentEvent {
  studentId: string
  lessonId: string
  sectionId: string
  eventType: 'start' | 'complete' | 'error' | 'interaction'
  timestamp: Date
  data?: any
  metadata?: Record<string, any>
}
```

**回传数据类型：**
- 体验互动完成情况
- 实验运行状态和结果
- 作业提交状态和内容
- 学习行为数据（点击、停留时间等）

#### 2.4.3 课堂报告生成
```typescript
interface LessonReport {
  lessonId: string
  classId: string
  instructorId: string
  summary: {
    totalDuration: number
    sectionDurations: Record<string, number>
    studentCount: number
    participationRate: number
    completionRate: number
  }
  sectionAnalytics: SectionAnalytics[]
  studentAnalytics: StudentAnalytics[]
  aiInsights: AIInsight[]
  recommendations: string[]
}
```

## 3. 技术架构设计

### 3.1 前端架构

#### 3.1.1 组件结构
```
src/
├── components/
│   ├── course/
│   │   ├── CourseEditor.vue          # 课程编辑器
│   │   ├── SectionEditor.vue         # 环节编辑器
│   │   └── ResourceSelector.vue      # 资源选择器
│   ├── presenter/
│   │   ├── PresenterMode.vue         # 播放模式主组件
│   │   ├── SectionRenderer.vue       # 环节渲染器
│   │   ├── StudentStatusPanel.vue    # 学生状态面板
│   │   └── ControlBar.vue            # 控制栏
│   ├── resources/
│   │   ├── SlidePlayer.vue           # PPT播放器
│   │   ├── MediaPlayer.vue           # 视频播放器
│   │   ├── HTMLExperience.vue        # HTML体验容器
│   │   └── NotebookPreview.vue       # Notebook预览
│   └── common/
│       ├── AnnotationLayer.vue       # 批注层
│       └── AIPanel.vue               # AI助手面板
```

#### 3.1.2 状态管理
```typescript
// Pinia Stores
const courseStore = useCourseStore()
const classroomStore = useClassroomStore()
const presenterStore = usePresenterStore()
const resourceStore = useResourceStore()
```

#### 3.1.3 路由设计
```typescript
const routes = [
  {
    path: '/courses/:id/edit',
    component: CourseEditor,
    meta: { requiresAuth: true, role: 'teacher' }
  },
  {
    path: '/classrooms/:classId/lessons/:lessonId/present',
    component: PresenterMode,
    meta: { requiresAuth: true, role: 'teacher' }
  },
  {
    path: '/student/lessons/:lessonId',
    component: StudentLessonView,
    meta: { requiresAuth: true, role: 'student' }
  }
]
```

### 3.2 后端架构

#### 3.2.1 服务划分
- **course-service**：课程管理、版本控制、资源引用
- **classroom-service**：班级管理、排课、课堂状态
- **lab-service**：实验环境、Jupyter运行时
- **ai-service**：内容生成、智能建议、数据分析
- **media-service**：文件处理、格式转换、CDN管理

#### 3.2.2 数据模型
```sql
-- 课程表
CREATE TABLE courses (
  id UUID PRIMARY KEY,
  title VARCHAR(255) NOT NULL,
  description TEXT,
  structure JSONB NOT NULL,
  version INTEGER DEFAULT 1,
  created_by UUID REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 课堂实例表
CREATE TABLE lesson_instances (
  id UUID PRIMARY KEY,
  course_id UUID REFERENCES courses(id),
  class_id UUID REFERENCES classrooms(id),
  scheduled_time TIMESTAMP NOT NULL,
  status VARCHAR(20) DEFAULT 'scheduled',
  presenter_state JSONB,
  created_at TIMESTAMP DEFAULT NOW()
);

-- 学生事件表
CREATE TABLE student_events (
  id UUID PRIMARY KEY,
  lesson_instance_id UUID REFERENCES lesson_instances(id),
  student_id UUID REFERENCES users(id),
  section_index INTEGER NOT NULL,
  event_type VARCHAR(50) NOT NULL,
  data JSONB,
  timestamp TIMESTAMP DEFAULT NOW()
);
```

#### 3.2.3 API设计
```typescript
// 课程管理API
POST   /api/courses                     // 创建课程
PUT    /api/courses/:id                 // 更新课程
GET    /api/courses/:id/versions        // 获取版本列表
POST   /api/courses/:id/publish         // 发布版本

// 排课API
POST   /api/classrooms/:classId/schedule // 排课
PUT    /api/lessons/:id/start           // 开始上课
PUT    /api/lessons/:id/next            // 下一环节
POST   /api/lessons/:id/end             // 结束上课

// 学生同步API
GET    /api/student/lessons/:id/current // 获取当前环节
POST   /api/student/events              // 提交学习事件
GET    /api/student/lessons/:id/report  // 获取学习报告
```

### 3.3 实时通信架构

#### 3.3.1 WebSocket事件
```typescript
// 教师端 -> 学生端
interface TeacherEvents {
  'lesson:start': { lessonId: string }
  'lesson:next': { sectionIndex: number }
  'lesson:pause': { reason?: string }
  'lesson:end': { summary?: any }
  'annotation:add': { annotation: Annotation }
}

// 学生端 -> 教师端
interface StudentEvents {
  'student:join': { studentId: string }
  'student:leave': { studentId: string }
  'student:progress': { sectionIndex: number, progress: number }
  'student:complete': { sectionIndex: number, result?: any }
  'student:error': { error: string }
}
```

#### 3.3.2 房间管理
```typescript
interface RoomManager {
  // 创建课堂房间
  createRoom(lessonId: string): Promise<string>

  // 学生加入房间
  joinRoom(roomId: string, studentId: string): Promise<void>

  // 广播教师操作
  broadcastTeacherAction(roomId: string, action: TeacherEvent): void

  // 收集学生状态
  collectStudentStates(roomId: string): Promise<StudentState[]>
}
```

## 4. 实施计划

### 4.1 阶段一：基础课程编辑器 (4周)
**目标**：实现基础的五环节课程创建和编辑功能

**主要任务：**
- [x] 课程数据模型设计和实现
- [x] 五环节编辑器UI组件
- [x] 资源引用系统
- [x] 基础版本控制
- [x] 课程预览功能

**验收标准：**
- 教师可以创建完整的五环节课程
- 支持PPT、视频、图片等基础资源
- 课程可以保存为草稿或发布版本

### 4.2 阶段二：资源渲染系统 (3周)
**目标**：实现多媒体资源的统一渲染和播放

**主要任务：**
- [x] PPT转HTML处理流程
- [x] 统一媒体播放器
- [x] HTML体验沙箱环境
- [x] Notebook预览组件
- [x] 资源预加载机制

**验收标准：**
- 所有资源类型都能正常渲染
- 支持批注和交互功能
- 资源加载性能优化

### 4.3 阶段三：Presenter播放模式 (4周)
**目标**：实现教师端的课堂教学播放功能

**主要任务：**
- [x] Presenter模式UI界面
- [x] 环节切换逻辑
- [x] 批注和激光笔工具
- [x] 课堂控制功能
- [x] AI助手集成

**验收标准：**
- 教师可以流畅控制课堂进程
- 支持多种交互方式（键盘、鼠标、遥控器）
- 实时AI建议功能正常

### 4.4 阶段四：学生端同步 (3周)
**目标**：实现学生端的实时同步和交互

**主要任务：**
- [x] WebSocket实时通信
- [x] 学生端界面开发
- [x] 状态同步机制
- [x] 学习事件收集
- [x] 离线容错处理

**验收标准：**
- 学生端能实时同步教师操作
- 学习数据能准确回传
- 网络异常时有合理的降级方案

### 4.5 阶段五：课堂报告与分析 (3周)
**目标**：实现课堂数据分析和报告生成

**主要任务：**
- [x] 学习数据分析算法
- [x] 报告生成系统
- [x] AI洞察和建议
- [x] 历史记录管理
- [x] 数据可视化

**验收标准：**
- 自动生成详细的课堂报告
- 提供有价值的教学建议
- 支持历史数据查询和对比

### 4.6 阶段六：测试与优化 (2周)
**目标**：全面测试和性能优化

**主要任务：**
- [x] 端到端流程测试
- [x] 性能压力测试
- [x] 用户体验测试
- [x] 安全性测试
- [x] 文档完善

**验收标准：**
- 所有功能测试通过
- 性能指标满足要求
- 用户反馈积极

## 5. 技术风险与应对

### 5.1 性能风险
**风险**：大量资源加载导致课堂播放卡顿
**应对方案**：
- 实施智能预加载策略
- 使用CDN加速静态资源
- 提供资源压缩和优化

### 5.2 兼容性风险
**风险**：不同设备、浏览器的兼容性问题
**应对方案**：
- 使用标准化的Web技术
- 提供多版本降级方案
- 建立完善的测试矩阵

### 5.3 网络稳定性风险
**风险**：网络中断影响课堂教学
**应对方案**：
- 实施离线缓存机制
- 提供本地降级方案
- 建立断线重连机制

### 5.4 安全性风险
**风险**：学生执行恶意代码或数据泄露
**应对方案**：
- 严格的沙箱隔离策略
- 完善的权限控制机制
- 定期安全审计和更新

## 6. 成功指标

### 6.1 技术指标
- **系统可用性**：≥99.5%
- **响应时间**：课堂切换延迟<500ms
- **并发支持**：单课堂支持100+学生
- **资源加载**：95%资源3秒内完成加载

### 6.2 业务指标
- **用户采用率**：80%教师使用五环节模式
- **课堂完成率**：90%课程能顺利完成
- **学生参与度**：课堂互动率提升30%
- **教学效率**：备课时间减少40%

### 6.3 用户体验指标
- **易用性评分**：用户满意度≥4.5/5
- **学习曲线**：新用户1小时内上手
- **错误率**：操作错误率<5%
- **支持请求**：技术支持请求减少50%

## 7. 附录

### 7.1 术语表
- **ACL Structure**：Advanced Course Learning Structure，高级课程学习结构
- **Presenter Mode**：教师课堂播放模式
- **Resource Vault**：统一资源库
- **AI Assistant**：人工智能教学助手

### 7.2 参考资料
- ReOpenInnoLab 项目原则文档
- 现有技术架构文档
- 用户研究报告
- 竞品分析报告

### 7.3 变更记录
| 版本 | 日期 | 作者 | 变更内容 |
|------|------|------|----------|
| 1.0 | 2025-11-08 | Claude | 初始版本创建 |